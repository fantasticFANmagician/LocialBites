<!DOCTYPE html>
<html lang="en">
<head>
    <title>LocalBites</title>
</head>
<body>
    <h1>LocalBites App</h1>
    <p>Firebase serve test</p>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBANabE0e0mkorWjUdxMsI0JurToHwtJ8o&libraries=places&callback=initMap"
    async defer></script>

    <script>
        let map;
        let markers = [];
        let userLocation;
        let placesService;
        const METERS_PER_KM = 1000;

        function initMap() {
            // Default to Port of Spain if geolocation fails
            const defaultLocation = { lat: 10.6603, lng: -61.5086 };
            
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: defaultLocation
            });

            placesService = new google.maps.places.PlacesService(map);

            // Get user location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map.setCenter(userLocation);
                        addUserMarker(userLocation);
                        searchRestaurants(); // Initial search
                    },
                    () => {
                        // Fallback to default location
                        userLocation = defaultLocation;
                        searchRestaurants();
                    }
                );
            } else {
                userLocation = defaultLocation;
                searchRestaurants();
            }

            // Setup UI controls
            document.getElementById('radius-slider').addEventListener('input', function() {
                document.getElementById('radius-value').textContent = this.value + ' km';
            });

            document.getElementById('search-btn').addEventListener('click', searchRestaurants);
        }

        function createMap(center) {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: center,
                mapTypeControl: false,
                streetViewControl: false
            });

            
            new google.maps.Marker({
                position: center,
                map: map,
                title: "Your Location",
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                }
            });
        }

        function addUserMarker(position) {
            new google.maps.Marker({
                position: position,
                map: map,
                title: "Your Location",
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                }
            });
            
            // Add circle showing search radius
            new google.maps.Circle({
                strokeColor: "#4285F4",
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: "#4285F4",
                fillOpacity: 0.2,
                map: map,
                center: userLocation,
                radius: getCurrentRadius()
            });
        }

        function getCurrentRadius() {
            const km = parseInt(document.getElementById('radius-slider').value);
            return km * METERS_PER_KM;
        }



    </script>


</body>
</html>