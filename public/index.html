<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrivacyLink - URL Unshortener & Privacy Tool</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #166088;
            --danger: #d33f49;
            --success: #4caf50;
            --warning: #ff9800;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            margin-bottom: 20px;
        }
        
        #url-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
            outline: none;
        }
        
        #url-input:focus {
            border-color: var(--primary);
        }
        
        #unshorten-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 0 4px 4px 0;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        #unshorten-btn:hover {
            background-color: var(--secondary);
        }
        
        .result-container {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-card {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 4px 4px 0;
        }
        
        .result-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .result-title i {
            margin-right: 8px;
        }
        
        .result-value {
            word-break: break-all;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge-success {
            background-color: var(--success);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .badge-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .badge-info {
            background-color: var(--secondary);
            color: white;
        }
        
        .login-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .toggle-login {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }
        
        .login-form {
            display: none;
            margin-top: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .blocklist-section {
            margin-top: 30px;
            display: none;
        }
        
        .blocklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .blocklist-actions {
            display: flex;
            gap: 10px;
        }
        
        #blocklist-items {
            list-style: none;
        }
        
        #blocklist-items li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        #blocklist-items li:last-child {
            border-bottom: none;
        }
        
        .remove-domain {
            color: var(--danger);
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.2rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .features {
            margin-top: 40px;
        }
        
        .features h2 {
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .feature-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px 0;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            #url-input {
                border-radius: 4px;
                margin-bottom: 10px;
            }
            
            #unshorten-btn {
                border-radius: 4px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>PrivacyLink</h1>
            <p class="tagline">Unshorten URLs safely and protect your privacy</p>
        </div>
    </header>
    
    <div class="container">
        <div class="main-card">
            <div class="input-group">
                <input type="url" id="url-input" placeholder="Paste a shortened URL (e.g., bit.ly/xyz, t.co/abc)" autocomplete="off">
                <button id="unshorten-btn">Unshorten</button>
            </div>
            
            <div id="result-container" class="result-container">
                <div class="result-card">
                    <div class="result-title">
                        <i>üîó</i> Original URL
                        <span id="original-url-status" class="badge"></span>
                    </div>
                    <div id="original-url" class="result-value"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">
                        <i>üõ°Ô∏è</i> Final URL
                        <span id="final-url-status" class="badge"></span>
                    </div>
                    <div id="final-url" class="result-value"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">
                        <i>üîç</i> Security Analysis
                        <span id="security-status" class="badge"></span>
                    </div>
                    <div id="security-info" class="result-value"></div>
                </div>
            </div>
            
            <div class="login-section">
                <button id="toggle-login" class="toggle-login">Login to access blocklist features</button>
                
                <div id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter password">
                    </div>
                    <div class="form-actions">
                        <button id="cancel-login" class="btn btn-secondary">Cancel</button>
                        <button id="submit-login" class="btn btn-primary">Login</button>
                    </div>
                </div>
            </div>
            
            <div id="blocklist-section" class="blocklist-section">
                <div class="blocklist-header">
                    <h3>Your Blocklist</h3>
                    <div class="blocklist-actions">
                        <input type="text" id="new-domain" placeholder="Add domain (e.g., ad.doubleclick.net)" style="padding: 5px;">
                        <button id="add-domain" class="btn btn-primary">Add</button>
                    </div>
                </div>
                <ul id="blocklist-items"></ul>
            </div>
        </div>
        
        <div class="features">
            <h2>Core Features</h2>
            
            <div class="feature-card">
                <h3>URL Unshortening</h3>
                <p>Resolves shortened URLs to their final destination without loading the content, preventing tracking pixels, cookies, or malware from being activated.</p>
            </div>
            
            <div class="feature-card">
                <h3>Privacy Protection</h3>
                <p>Strips referrer headers and doesn't store cookies when checking URLs. Warns about suspicious tracking domains.</p>
            </div>
            
            <div class="feature-card">
                <h3>User Blocklist</h3>
                <p>Logged-in users can maintain and share blocklists of domains they want to avoid (trackers, malware, etc.).</p>
            </div>
            
            <div class="feature-card">
                <h3>Advanced Security Checks</h3>
                <p>Checks URLs against Google Safe Browsing and Spamhaus DBL to detect phishing and spammy links.</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p>PrivacyLink &copy; 2023 | Protect your privacy while browsing</p>
    </footer>

    <script>
        // DOM Elements
        const urlInput = document.getElementById('url-input');
        const unshortenBtn = document.getElementById('unshorten-btn');
        const resultContainer = document.getElementById('result-container');
        const originalUrl = document.getElementById('original-url');
        const finalUrl = document.getElementById('final-url');
        const securityInfo = document.getElementById('security-info');
        const originalUrlStatus = document.getElementById('original-url-status');
        const finalUrlStatus = document.getElementById('final-url-status');
        const securityStatus = document.getElementById('security-status');
        
        // Login elements
        const toggleLoginBtn = document.getElementById('toggle-login');
        const loginForm = document.getElementById('login-form');
        const cancelLoginBtn = document.getElementById('cancel-login');
        const submitLoginBtn = document.getElementById('submit-login');
        const blocklistSection = document.getElementById('blocklist-section');
        
        // Blocklist elements
        const newDomainInput = document.getElementById('new-domain');
        const addDomainBtn = document.getElementById('add-domain');
        const blocklistItems = document.getElementById('blocklist-items');
        
        // App state
        let isLoggedIn = false;
        let currentUser = null;
        let blocklist = [];
        
        // Mock user database
        const users = {
            'bob': { password: 'bobpass', blocklist: ['ad.doubleclick.net', 'tracker.example.com'] },
            'alice': { password: 'alicepass', blocklist: ['malware-domain.com'] }
        };
        
        // Initialize the app
        function init() {
            const savedUser = localStorage.getItem('privacyLinkUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    if (users[userData.username] && users[userData.username].password === userData.password) {
                        loginUser(userData.username);
                    }
                } catch (e) {
                    console.error('Error parsing saved user data', e);
                }
            }
            
            if (isLoggedIn) {
                loadBlocklist();
            }
        }
        
        // Event Listeners
        unshortenBtn.addEventListener('click', unshortenUrl);
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                unshortenUrl();
            }
        });
        
        toggleLoginBtn.addEventListener('click', toggleLoginForm);
        cancelLoginBtn.addEventListener('click', toggleLoginForm);
        submitLoginBtn.addEventListener('click', handleLogin);
        addDomainBtn.addEventListener('click', addToBlocklist);
        newDomainInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addToBlocklist();
            }
        });
        
        // Functions
        function toggleLoginForm() {
            loginForm.style.display = loginForm.style.display === 'block' ? 'none' : 'block';
            toggleLoginBtn.textContent = loginForm.style.display === 'block' ? 'Cancel login' : 'Login to access blocklist features';
        }
        
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            if (users[username] && users[username].password === password) {
                loginUser(username);
                toggleLoginForm();
            } else {
                alert('Invalid username or password');
            }
        }
        
        function loginUser(username) {
            isLoggedIn = true;
            currentUser = username;
            toggleLoginBtn.textContent = `Logged in as ${username}`;
            toggleLoginBtn.style.textDecoration = 'none';
            blocklistSection.style.display = 'block';
            
            localStorage.setItem('privacyLinkUser', JSON.stringify({
                username: username,
                password: users[username].password
            }));
            
            loadBlocklist();
        }
        
        function loadBlocklist() {
            if (!isLoggedIn) return;
            
            blocklist = [...users[currentUser].blocklist];
            renderBlocklist();
        }
        
        function renderBlocklist() {
            blocklistItems.innerHTML = '';
            
            if (blocklist.length === 0) {
                blocklistItems.innerHTML = '<li>No domains in your blocklist yet</li>';
                return;
            }
            
            blocklist.forEach(domain => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${domain}</span>
                    <button class="remove-domain" data-domain="${domain}">√ó</button>
                `;
                blocklistItems.appendChild(li);
            });
            
            document.querySelectorAll('.remove-domain').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const domain = e.target.getAttribute('data-domain');
                    removeFromBlocklist(domain);
                });
            });
        }
        
        function addToBlocklist() {
            const domain = newDomainInput.value.trim();
            
            if (!domain) {
                alert('Please enter a domain to block');
                return;
            }
            
            if (!/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(domain)) {
                alert('Please enter a valid domain (e.g., example.com)');
                return;
            }
            
            if (blocklist.includes(domain)) {
                alert('This domain is already in your blocklist');
                return;
            }
            
            blocklist.push(domain);
            users[currentUser].blocklist = [...blocklist];
            newDomainInput.value = '';
            renderBlocklist();
        }
        
        function removeFromBlocklist(domain) {
            blocklist = blocklist.filter(d => d !== domain);
            users[currentUser].blocklist = [...blocklist];
            renderBlocklist();
        }
        
        async function unshortenUrl() {
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Please enter a URL');
                return;
            }
            
            try {
                new URL(url);
            } catch (e) {
                alert('Please enter a valid URL (e.g., https://bit.ly/xyz)');
                return;
            }
            
            unshortenBtn.disabled = true;
            unshortenBtn.innerHTML = 'Processing <span class="loading"></span>';
            
            resultContainer.style.display = 'none';
            originalUrl.textContent = '';
            finalUrl.textContent = '';
            securityInfo.textContent = '';
            originalUrlStatus.textContent = '';
            finalUrlStatus.textContent = '';
            securityStatus.textContent = '';
            
            try {
                originalUrl.textContent = url;
                
                // Use a proxy approach to bypass CORS
                const finalUrlData = await resolveUrlWithProxy(url);
                
                finalUrl.textContent = finalUrlData.finalUrl;
                
                const securityData = await checkUrlSecurity(finalUrlData.finalUrl);
                
                originalUrlStatus.textContent = 'Original';
                originalUrlStatus.className = 'badge badge-info';
                
                if (finalUrlData.redirected) {
                    finalUrlStatus.textContent = 'Unshortened';
                    finalUrlStatus.className = 'badge badge-success';
                } else {
                    finalUrlStatus.textContent = 'No redirect';
                    finalUrlStatus.className = 'badge badge-info';
                }
                
                if (isLoggedIn) {
                    const domain = new URL(finalUrlData.finalUrl).hostname;
                    if (blocklist.some(blockedDomain => domain.includes(blockedDomain))) {
                        securityData.warnings.push(`Domain ${domain} is in your blocklist`);
                        securityData.isMalicious = true;
                    }
                }
                
                if (securityData.isMalicious) {
                    securityStatus.textContent = 'Unsafe';
                    securityStatus.className = 'badge badge-danger';
                } else if (securityData.warnings.length > 0) {
                    securityStatus.textContent = 'Caution';
                    securityStatus.className = 'badge badge-warning';
                } else {
                    securityStatus.textContent = 'Safe';
                    securityStatus.className = 'badge badge-success';
                }
                
                if (securityData.isMalicious) {
                    securityInfo.innerHTML = `
                        <p><strong>‚ö†Ô∏è Warning:</strong> This URL appears to be malicious.</p>
                        <ul>
                            ${securityData.warnings.map(w => `<li>${w}</li>`).join('')}
                        </ul>
                        <p>We recommend not visiting this site.</p>
                    `;
                } else if (securityData.warnings.length > 0) {
                    securityInfo.innerHTML = `
                        <p><strong>‚ö†Ô∏è Caution:</strong> This URL has some potential issues:</p>
                        <ul>
                            ${securityData.warnings.map(w => `<li>${w}</li>`).join('')}
                        </ul>
                        <p>Proceed with caution.</p>
                    `;
                } else {
                    securityInfo.innerHTML = `
                        <p><strong>‚úì Safe:</strong> No security issues detected with this URL.</p>
                        <p>${securityData.isShortened ? 'This was a shortened URL that has been resolved.' : 'This is a direct link.'}</p>
                    `;
                }
                
                resultContainer.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing URL: ${error.message}`);
            } finally {
                unshortenBtn.disabled = false;
                unshortenBtn.textContent = 'Unshorten';
            }
        }
        
        async function resolveUrlWithProxy(url) {
            // In a production environment, you would call your own backend API here
            // that makes the HEAD request server-side and returns the final URL
            
            // For this demo, we'll simulate the behavior with known shortened URLs
            // and a mock API response
            
            // Known shortened URLs for demo purposes
            const demoShortUrls = {
                'https://bit.ly/3xYz': 'https://example.com/some-long-path',
                'https://t.co/abc123': 'https://twitter.com/some-tweet',
                'https://goo.gl/xyz789': 'https://google.com/some-page',
                'https://tinyurl.com/2bcdef': 'https://example.org/another-long-url'
            };
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            if (demoShortUrls[url]) {
                return {
                    finalUrl: demoShortUrls[url],
                    redirected: true,
                    isShortened: true
                };
            }
            
            // For other URLs, pretend they're not shortened
            return {
                finalUrl: url,
                redirected: false,
                isShortened: false
            };
        }
        
        async function checkUrlSecurity(url) {
            const result = {
                isMalicious: false,
                warnings: [],
                isShortened: false
            };
            
            let domain;
            try {
                domain = new URL(url).hostname;
            } catch (e) {
                result.warnings.push('Invalid URL format');
                result.isMalicious = true;
                return result;
            }
            
            // Check if shortened URL
            const shortDomains = ['bit.ly', 'goo.gl', 't.co', 'tinyurl.com', 'ow.ly', 'buff.ly', 'is.gd'];
            const isShortened = shortDomains.some(shortDomain => domain.includes(shortDomain));
            result.isShortened = isShortened;
            
            if (isShortened) {
                result.warnings.push('This link was shortened, which can hide the true destination');
            }
            
            // Check against blocklist
            if (isLoggedIn && blocklist.some(blockedDomain => domain.includes(blockedDomain))) {
                result.warnings.push(`Domain ${domain} is in your blocklist`);
                result.isMalicious = true;
            }
            
            // Mock security checks
            const maliciousDomains = ['malware.example.com', 'phishing-site.com', 'evil-tracker.net'];
            if (maliciousDomains.includes(domain)) {
                result.warnings.push('This domain is known for malicious activity (Google Safe Browsing)');
                result.isMalicious = true;
            }
            
            const spamDomains = ['spammy-site.com', 'ad-tracker.org'];
            if (spamDomains.includes(domain)) {
                result.warnings.push('This domain is listed in Spamhaus DBL (spam database)');
                result.isMalicious = true;
            }
            
            // Check for tracking parameters
            if (url.includes('utm_') || url.includes('fbclid=') || url.includes('gclid=')) {
                result.warnings.push('URL contains tracking parameters');
            }
            
            return result;
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>